---
name: generate ical from kuehn
on: [push]
jobs:
   regenerate-calendar:
      runs-on: ubuntu-latest
      steps:
        - uses: actions/checkout@v2
        - uses: actions/setup-python@v2.3.1
          with:
            # Version range or exact version of a Python version to use, using SemVer's version range syntax.
            python-version:  3.x # optional, default is 3.x
            # Used to specify a package manager for caching in the default directory. Supported values: pip, pipenv.
            cache: pipenv # optional
        - run: |
            python -m pip install --upgrade pipenv wheel
        - id: cache-pipenv
          uses: actions/cache@v1
          with:
             path: ~/.local/share/virtualenvs
             key: ${{ runner.os }}-pipenv-${{ hashFiles('**/Pipfile.lock') }}

        - name: Install dependencies
          if: steps.cache-pipenv.outputs.cache-hit != 'true'
          run: |
            pipenv install --deploy --dev   
        - run: pipenv run python appointments/calender_throughput.py > output/2022.ics
        - uses: actions/upload-artifact@v2
          with:
            path: output/2022.ics
            name: kuehl_calendar
         
   publish-new-calendar:
       needs: regenerate-calendar
       runs-on: ubuntu-latest
       steps:
          - uses: actions/checkout@v2
            with:
              ref: gh-pages
          - uses: actions/download-artifact@v2.1.0
            with: 
               name: kuehl_calendar
               path: kuehl_calendar.ics
          - run: |
              git add kuehl_calendar.ics
              git commit -m 'Update calendar file'
              git push 
          
       
        

